<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Wien Robinson's frequency Bridge</title>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
    integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <script src="jsplumb.min.js"></script>

  <script async="true" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=AM_CHTML"> </script>
  <script async="true" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/MathJax.js?config=AM_CHTML"> </script>
  <script async="true" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=AM_CHTML"> </script>




  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.all.min.js"></script>

  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
    integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

  <style>
    #diagram,
    #toolbox {
      margin: 20px 0;
      border-width: 2px;
      border-style: solid;
      border-color: black;
      height: 960px;
    }

    #toolbox {
      display: flex;
      padding: 10px;
      flex-flow: row wrap;
      align-content: flex-start;
    }

    .control {
      border-color: black;
      border-radius: 10px;
      border-width: 2px;
      border-style: solid;
      width: 90px;
      text-align: center;
      cursor: move;
      height: fit-content;
      height: -moz-max-content;
      background-color: white;
    }

    #diagram .control {
      position: absolute;
    }

    .window {
      z-index: 20;
    }

    .jtk-connector {
      z-index: 4;
    }

    .jtk-endpoint {
      z-index: 5;
    }

    .jtk-overlay {
      z-index: 6;
    }

    .custom-menu {
      z-index: 1000;
      position: absolute;
      background-color: #C0C0C0;
      border: 1px solid black;
      padding: 0px;
    }

    #toolbox .control {
      margin: 10px 5px;
    }


    #instruction {
      margin: 20px 0px;
      border-width: 2px;
      /* border-style: solid;
          border-color: lightgrey; */
      height: 998px;
      width: 2000px;
    }

    #inst {
      height: 70vh;

    }


    .black_overlay {
      display: none;
      position: absolute;
      top: 0%;
      left: 0%;
      width: 100%;
      height: 100%;
      background-color: black;
      z-index: 1001;
      -moz-opacity: 0.8;
      opacity: .80;
      filter: alpha(opacity=80);
    }

    .white_content {
      display: none;
      position: absolute;
      top: 10%;
      left: -148%;
      width: 137%;
      height: 70%;
      padding: 8px;
      border: 1px solid #808080;
      background-color: white;
      z-index: 1002;
      overflow: auto;
      box-shadow: 10px 11px 23px #212529;
    }

    table,
    th,
    td {
      border: 1px solid black;
    }

    #myTable {
      border: 1px solid black;
      width: 250px;
      height: 10%;
    }

    .no-pointer-events {
      pointer-events: none;
    }

    .slidecontainer {
      width: 100%;
    }

    .slider {
      appearance: none;
      width: 100%;
      height: 25px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }

    .slider:hover {
      opacity: 1;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 25px;
      height: 25px;
      background: #04AA6D;
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 25px;
      height: 25px;
      background: #04AA6D;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div style="position: absolute;border: 2px solid black;    top: -32px;">
    <div class="container-fluid">
      <div style="position:relative;    top: 66.8em;left:-1em;color:white;background-color: #cb3535;width: 101.6%;text-align: center;height: 33px;
  padding: 5px;">
        Copyright&copy;2023 | Lab developed by Virtual Labs, IIT Roorkee</div><br>
      <div class="row">
        <div class="col-md-2">
          <h3 style="    position: absolute;
      border: 2px solid black;
      width: 323px;
      text-align: center;background-color: #cb3535;color: white;border-radius: 6px;
  ">Components</h3>
          <div id="toolbox" class="justify-content-center" style="    position: absolute;
      top: 20px;
      width: 323px;
      height: 204px;
  ">
            <div class="control r"><img src="resistor.png" width="70px" height="70px"></div>
            <div class="control d"><img src="detector.png" width="70px" height="70px"></div>
            <div class="control v"><img src="ac.png" width="70px" height="70px"></div>
            <div class="control c"><img src="capacitor.png" width="70px" height="70px"></div>
            <h3 style="    position: absolute;
            border: 2px solid black;
            width: 323px;
            text-align: center;background-color: #cb3535;color: white;border-radius: 6px;top: 216px;
        ">Formulae</h3>
            <div id="formulae" style="    position: absolute;
        top: 258px;
        padding: 12px;border: 2px solid black;height: 348%;    font-size: 21px; text-align: justify;">
              <h6>After balancing circuit, equating real part we have:</h6>
              <b> `frac(R4)(R3) = frac(C1)(C2) + frac(R2)(R1)`</b><br>
              <h6>Also, equating imaginary part we have: </h6>
              `f = frac(1)(2pisqrt(R1R2C1C2))`
            </div>
          </div>
        </div>
        <div class="col-md-7">
          <h3 style="    position: absolute;
        border: 2px solid black;
        border-radius: 6px;
        width: 96.4%;
        text-align: center;right: 0px;background-color: #cb3535;color: white;
    ">WorkSpace</h3>
          <div id="diagram" style="    height: 960px; position: absolute;width: 96.4%;top: 20px;right: 0px;">
            <button style="    position: absolute;
          bottom: 14px;
          right: 692px;
          width: 120px;
  " class="btn btn-danger">Check Circuit</button>
</div>
            <button style="position: absolute;
  bottom: 54px;
  right: 553px;
  width: 120px;
  " class="btn btn-warning
  " onclick="window.location.reload()">Reset</button>
            <button style="    position: absolute;
  bottom: 54px;
  right: 414px;
  width: 120px;
  " class="btn btn-primary" onclick="window.print()">Print</button>


<div id="digital-m" style="background-color:rgb(7, 7, 7); width: 120px; height: 50px; ;border:inset 6px lightgray;position:absolute;    top: 51px;
left: 1502px; ">
      <b>
        <p id="digi"
          style="text-align: center; margin:5px; font-size:1.5rem; font-family:'Seven Segment'sans-serif;color:crimson;">
          --.--</p>
      </b>
    </div>


            

        </div>

      

        <div class="col-md-3" id="instruction">
          <div id="inst" class="col-sm">
            <p style="    position: relative;
            top: 30px;
    right: 167px; width:300px"><a href="javascript:void(0)"
                onclick="document.getElementById('light').style.display='block';document.getElementById('fade').style.display='none'"
                class="btn btn-danger"><b>Instructions</b></a>
            <!-- <p><a href="javascript:void(0)"
                onclick="document.getElementById('light').style.display='block';document.getElementById('fade').style.display='block'"><b>Instructions</b></a>
            </p> -->
            <div id="light" class="white_content"><b>Wien Robinson's frequency Bridge</b><br>
              <img src="robinson1.png" width="550px" height="450px">
              <ul>&bull;Pick up four resistances,two capacitors, a ac voltage source and a detector from the toolbox.
              </ul><br>
              <ul>&bull;Connect the elements as shown in the figure to form a Wien Robinson's frequency Bridge.</ul><br>
              <ul>&bull;After making the circuit click on check circuit button to check the connections</ul><br>
              <ul>&bull;Select the ratio (R4/R3) from the dropdown available (default value is 2)</ul><br>
              <ul>&bull;Now enter the values of resistors and capacitors such that first equation of balancing is satisfied i.e. (R4/R3)=(R2/R1) +(C1/C2). Enter AC voltage source value and click on the submit
                button. A blanck value of digital meter indicates that first balancing condition is not met.</ul><br>
              <ul>&bull;After entrering all values digital meter shows deviation from the actual frequency value where a negative value shows that calculated frequency is lesser than the actual frequency while a positive value refers to larger calculated value
                and a zero value represents balanced bridge.
              </ul><br>
              <ul>&bull;In order to fix negative value of digital meter decrease the resistance and capacitance values keeping the initial ratio constant and for fixing a positive value increase the resistance and capacitance value satisfying the first balancing condition.
              </ul><br>
              <ul>&bull;Repeat the experiment until the bridge gets balanced.</ul><br>
              <ul>&bull;After balancing the bridge, unknown frequency will be automatically added to the observation table.</ul><br>
              <ul>&bull;Take atleast 5-7 readings at different value of inputs and calculate the average of all values.</ul><br>
              <a href="javascript:void(0)"
                onclick="document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'"
                class="btn btn-outline-danger" style="    position: absolute;
                top: 20px;
                right: 20px;"><span style="padding-top: 6px;" class="material-symbols-outlined">
                  close
                </span></a>
            </div>
            <div id="fade" class="black_overlay"></div>

            <!-- <p><a href="javascript:void(0)"
                onclick="document.getElementById('light2').style.display='block';document.getElementById('fade').style.display='block'"><b>Observations</b></a>
            </p> -->
            <div id="light2" class="white_content"><b>Observation Table</b><br>
              <!-- <table id="myTable">
                <tr>
                  <th>R1</th>
                  <th>R2</th>
                  <th>C1</th>
                  <th>C2</th>
                  <th>Voltage</th>
                  <th>`f`</th>
                </tr>
              </table> -->
              <a href="javascript:void(0)"
                onclick="document.getElementById('light2').style.display='none';document.getElementById('fade').style.display='none'">Close</a>
            </div>
            <div id="fade" class="black_overlay">

            </div>






            <!-- <p><a href="javascript:void(0)"
                onclick="document.getElementById('light1').style.display='block';document.getElementById('fade').style.display='block'"><b>Formulae</b></a>
            </p> -->
            <div id="light1" class="white_content"><b>Wien Robinson's frequency Bridge</b><br>




              <div id="formulae">


                <h6>After balancing circuit, equating real part we have:</h6>
                <b> `frac(R4)(R3) = frac(C1)(C2) + frac(R2)(R1)`</b><br>
                <h6>Also, equating imaginary part we have: </h6>
                `f = frac(1)(2pisqrt(R1R2C1C2))`
              </div>


              <a href="javascript:void(0)"
                onclick="document.getElementById('light1').style.display='none';document.getElementById('fade').style.display='none'">Close</a>
            </div>
            <div id="fade" class="black_overlay"></div>
            <h3 style="    position: relative;
            border: 2px solid black;
            width: 437px;
            text-align: center;background-color: #cb3535;color: white;border-radius: 6px;right: -3px;
            top: -74px;
        ">Calculations</h3>




            <div id="mydiv" style="display:block;border: 2px solid black; padding: 20px;width: 90%;   position: absolute;
            top: 26px;
    right: 27px;"><B>Give Input :</B><br><br>
              <form action="#" onsubmit="yourJsFunction();return false">

                <label><b>Enter R4/R3:</b></label>&nbsp;
                <select id="r3_select" style="width: 120px;" onchange="document.getElementById('r1_tag2').innerHTML='R3 = '+100+'&nbsp;Ω'; document.getElementById('r1_tag3').innerHTML='R4 = '+this.value*100+'&nbsp;Ω'; meterupdate() ">
                  <option value="s">select</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  
                </select><br>




                <label>Enter R1:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="number" id="data1" min="0" 
                max="1000000" step="0.1" onchange="document.getElementById('r1_tag0').innerHTML='R1 = '+this.value+'&nbsp;Ω'; meterupdate()">
            <br>
                

                <label>Enter R2:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="number" id="data2" min="0" 
                max="1000000" step="0.1" onchange="document.getElementById('r1_tag1').innerHTML='R2 = '+this.value+'&nbsp;Ω'; meterupdate()"><br>

                <!-- <label>Enter R3:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="number" id="data6" min="0" 
                max="1000000" step="0.1"><br>

                <label>Enter R4:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="number" id="data7" min="0" 
                max="1000000" step="0.1"><br> -->

                <label>Enter C1:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="number" id="data3" min="0.00000001" 
                max="0.000001" step="0.00000001" style="width: 120px;" onchange="document.getElementById('c1_tag0').innerHTML='C1 = '+this.value/0.000001+'&nbsp;µF'; meterupdate()"><br>

                <label>Enter C2:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="number" id="data4" min="0.00000001" 
                max="0.000001" step="0.00000001" style="width: 120px;" onchange="document.getElementById('c1_tag1').innerHTML='C2 = '+this.value/0.000001+'&nbsp;µF'; meterupdate()"><br>

                <label>Enter Voltage:</label>
                <input type="number" id="data5" style="width: 120px;" onchange="document.getElementById('abcd').innerHTML=this.value+'&nbsp;V'; meterupdate()"><br><br>

                <input id="btn1" class="btn btn-success" type="submit" disabled />

              </form><br>

              <!-- <button class="btn btn-danger" onClick="window.location.reload();">Reset</button>
              <input class="btn btn-primary" type="button" value="Print Report" onClick="window.print()"> -->
            </div>
            <h3 style="    position: relative;
          border: 2px solid black;
          width: 458px;
          text-align: center;background-color: #cb3535;color: white;border-radius: 6px;right: 6px; top: 320px;
      ">Observation Table</h3>
            <table id="myTable" style="    position: relative;
                  top: 325px;
            border: 2px solid black!important;
            right: 6px;
        width: 102%;
            height: 50px;text-align: center;" class="">
              <tr>
                <th>R1</th>
                <th>R2</th>
                <th>C1</th>
                <th>C2</th>
                <th>Voltage</th>
                <th>`f`</th>
              </tr>
            </table>

          </div>
        </div>
      </div>
    </div>
    <script>

      function touchHandler(event) {
        var touch = event.changedTouches[0];
    
        var simulatedEvent = document.createEvent("MouseEvent");
            simulatedEvent.initMouseEvent({
            touchstart: "mousedown",
            touchmove: "mousemove",
            touchend: "mouseup"
        } [event.type], true, true, window, 1,
            touch.screenX, touch.screenY,
            touch.clientX, touch.clientY, false,
            false, false, false, 0, null);
    
        touch.target.dispatchEvent(simulatedEvent);
        
    }
    
    function init() {
        document.addEventListener("touchstart", touchHandler, true);
        document.addEventListener("touchmove", touchHandler, true);
        document.addEventListener("touchend", touchHandler, true);
        document.addEventListener("touchcancel", touchHandler, true);
    }
    init();



    function randomIntFromInterval(min, max) { // min and max included 
      return Math.floor(Math.random() * (max - min + 1) + min)
    }
    



    
   



      const mydiv = document.getElementById('mydiv');
      var data5 = 1, data4 = 1, data3 = 1, data2 = 1, data1 = 1;
      let omega=50;
    
    function meterupdate(){
      var r1 = document.getElementById("data1").value;
        var r2 = document.getElementById("data2").value;
        var c1 = document.getElementById("data3").value;
        var c2 = document.getElementById("data4").value;
        var data5 = document.getElementById("data5").value;
        var r3 = $("#r3_select option:selected").val();

       


        if (r1 == "" || r2 == "" || r3 == "" || data5 == "" || c1 == "" || c2 == "") {
          //swal("Fill empty values");

          return;
        }



      
       /* r1 = parseFloat(r1);
        r2 = parseFloat(r2);
        r3 = parseFloat(r3);*/
        //r4 = parseFloat(r4);
        v = parseFloat(data5);
        //c1 = parseFloat(c1);
        //c2 = parseFloat(c2);
        console.log(r3);
        console.log(c1);
        console.log(v);

        if (r1 <= 0 || r2 <= 0 || r3 <= 0 || v <= 0 || c1 <= 1e-9 || c2 <= 1e-9 || r1>1e6 || r2>1e6 || c1>1e-6 || c2>1e-6) {
          swal("Invalid Values Select resistor values between 1Ω to 1MΩ and Capacitor values between 10nF to 1µF");

          return;
        }
        const freq = (1 / (2 * 3.14159265359)) * (1 / Math.sqrt(r1 * r2 * c1 * c2));
        var res;
        var num1=(r2/r1)+(c1/c2);
        //var num2=r3;
        console.log(r3);
        console.log(Math.abs(r3-num1));
        if(Math.abs(r3-num1)>0.2)
          {
            //console.log("inside this");
            res="--.--"
            document.getElementById("digi").innerHTML=res;
            var audio = new Audio('audio1_detector.mp3');
        audio.play();
        audio.volume = 0.1;
        //swal("Unbalanced");
        audio.addEventListener("canplaythrough", function () {
          setTimeout(function () {
            audio.pause();
          },
            3000);
        }, false);

      
          }
          else if(Math.abs(freq-omega)>omega/20){
            res=(freq-omega)/100;
            if(res<-1){
              res=-1;
              document.getElementById("digi").innerHTML = res;
            }
            else if(res>1){
              res=1;
              document.getElementById("digi").innerHTML = res;
            }
            else{
              res=res.toFixed(3);
              document.getElementById("digi").innerHTML = res;
            }
            var audio = new Audio('audio1_detector.mp3');
        audio.play();
        audio.volume = 0.1;
       // swal("Unbalanced");
        audio.addEventListener("canplaythrough", function () {
          setTimeout(function () {
            audio.pause();
          },
            3000);
        }, false);
          
          }
        else{
        //swal("f: " + freq);
        var remain=omega/100;
        if(Math.abs(freq-omega)>remain){
          res=(freq-omega)/100;
          res=res.toFixed(3);
          if(res<-1)
           res=-1;
          if(res>1)
           res=1;
          document.getElementById("digi").innerHTML = res;
          var audio = new Audio('audio2_detector.mp3');
        audio.play();
        audio.volume = 0.2;
        //swal("Unbalanced");
        audio.addEventListener("canplaythrough", function () {
          setTimeout(function () {
            audio.pause();
          },
            5000);
        }, false);

        }
        else{
          res=0;
          document.getElementById("digi").innerHTML = res;}
    }
  }










      function yourJsFunction() {
        var r1 = document.getElementById("data1").value;
        var r2 = document.getElementById("data2").value;
        var c1 = document.getElementById("data3").value;
        var c2 = document.getElementById("data4").value;
        var data5 = document.getElementById("data5").value;
        var r3 = document.getElementById("r3_select").value;
        //var r4 = document.getElementById("data7").value;
        // console.log(data1);
        if (r1 == "" || r2 == "" || r3 == "" || data5 == "" || c1 == "" || c2 == "") {
          swal("Fill empty values");

          return;
        }

        r1 = parseFloat(r1);
        r2 = parseFloat(r2);
        r3 = parseFloat(r3);
        //r4 = parseFloat(r4);
        v = parseFloat(data5);
        c1 = parseFloat(c1);
        c2 = parseFloat(c2);


        if (r1 <= 0 || r2 <= 0 || r3 <= 0 || v <= 0 || c1 <= 0 || c2 <= 0) {
          swal("Invalid Values");

          return;
        }
        // Create a new table row for each input value

        var row = document.createElement("tr");

        const arr = [r1, r2, c1, c2, v];
        const freq = (1 / (2 * 3.14159265359)) * (1 / Math.sqrt(r1 * r2 * c1 * c2));
        var res;
        var num1=(r2/r1)+(c1/c2);
        var num2=r3;
        console.log(freq);
        console.log(freq-omega);
        if(Math.abs(num2-num1)>0.2)
          {
            var audio = new Audio('audio1_detector.mp3');
        audio.play();
        audio.volume = 0.1;
        swal("Unbalanced");
        audio.addEventListener("canplaythrough", function () {
          setTimeout(function () {
            audio.pause();
          },
            3000);
        }, false);

      
          }
          else if(Math.abs(freq-omega)>omega/20){
            res=(freq-omega)/100;
            if(res<-1){
              res=-1;
              document.getElementById("digi").innerHTML = res;
            }
            else if(res>1){
              res=1;
              document.getElementById("digi").innerHTML = res;
            }
            else{
              res=res.toFixed(3);
              document.getElementById("digi").innerHTML = res;
            }
            var audio = new Audio('audio1_detector.mp3');
        audio.play();
        audio.volume = 0.1;
        swal("Unbalanced");
        audio.addEventListener("canplaythrough", function () {
          setTimeout(function () {
            audio.pause();
          },
            3000);
        }, false);
          
          }
        else{
        //swal("f: " + freq);
        var remain=omega/100;
        console.log(omega);
        console.log(freq);
        console.log(freq-omega);


        if(Math.abs(freq-omega)>remain){
          res=(freq-omega)/100;
          res=res.toFixed(3);
          document.getElementById("digi").innerHTML = res;
          var audio = new Audio('audio2_detector.mp3');
        audio.play();
        audio.volume = 0.2;
        swal("Unbalanced");
        audio.addEventListener("canplaythrough", function () {
          setTimeout(function () {
            audio.pause();
          },
            5000);
        }, false);

        }
        else{
          res=0;
          document.getElementById("digi").innerHTML = res;
        swal("balanced Bridge");
        for (var i = 1; i <= 5; i++) {
          // Get the value of the current input field
          var data = arr[i - 1];

          // Create a new table row element

          // Create a new table data element
          var cell = document.createElement("td");
          cell.innerHTML = data;

          // Add the table data to the table row
          row.appendChild(cell);

          // Add the table row to the table
          document.getElementById("myTable").appendChild(row);
        }


        var cell = document.createElement("td");
        cell.innerHTML = freq.toFixed(4);
        row.appendChild(cell);
        document.getElementById("myTable").appendChild(row);
      }
    }

      }




      var count1 = 1, count2 = 1, count3 = 1, count4 = 1, count5 = 1;
      // https://stackoverflow.com/a/2117523
      function uuidv4() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
          var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
          return v.toString(16);
        });
      }
      instance = jsPlumb.getInstance({});
      instance.setContainer("diagram");
      instance.bind("ready", function () {
        instance.registerConnectionTypes({
          "red-connection": {
            paintStyle: { stroke: "blue", strokeWidth: 3 },
            hoverPaintStyle: { stroke: "blue", strokeWidth: 5 },
            connector: "Flowchart"
          }
        });
        $(document).bind("click", function (event) {
          $("div.custom-menu").remove();
        });

        $("body").on("contextmenu", "#diagram .control", function (event) {
          event.preventDefault();
          window.selectedControl = $(this).attr("id");
          console.log(window.selectedControl);
          $("<div class='custom-menu'><button class='delete-control'>Delete control</button></div>")
            .appendTo("body")
            .css({ top: event.pageY + "px", left: event.pageX + "px" });
        });



        $("body").on("click", ".delete-control", function (event) {
          instance.remove(window.selectedControl);

        });

        $("#toolbox .control").draggable({
          helper: "clone",
          containment: "#diagram",
          appendTo: "#diagram"
        });


        $("#diagram").droppable({
          drop: function (event, ui) {
            var id;
            var clone = $(ui.helper).clone(true);
            var s = clone.attr("class");
            if (s[8] == 'r') {
              id = s[8] + count1.toString();
              count1++;
            }
            else if (s[8] == 'v') {
              id = s[8] + count2.toString();
              count2++;
            }
            else if (s[8] == 'd') {
              id = s[8] + count3.toString();
              count3++;
            }
            else if (s[8] == 'c') {
              id = s[8] + count4.toString();
              count4++;
            }
            clone.attr("id", id);
            clone.appendTo(this);
            instance.draggable(id, { containment: true });

            if (id[0] == 'v') {

              instance.addEndpoint(id, {
                endpoint: "Dot", maxConnections: 3,
                anchor: ["Left"],
                isSource: true, paintStyle: { fill: "red" },
                connectionType: "red-connection"
              });

              instance.addEndpoint(id, {
                endpoint: "Dot", maxConnections: 2,
                anchor: ["Right"],
                isTarget: true,
                connectionType: "red-connection"
              });

            }
            else if (id[0] == 'd') {
              instance.addEndpoint(id, {
                endpoint: "Dot", maxConnections: 2,
                anchor: ["Left"],
                isTarget: true,
                connectionType: "red-connection"
              });

              instance.addEndpoint(id, {
                endpoint: "Dot",
                anchor: ["Right"], paintStyle: { fill: "red" },
                isSource: true,
                connectionType: "red-connection"
              });

            }
            else {
              instance.addEndpoint(id, {
                endpoint: "Dot", maxConnections: 2,
                anchor: ["Right"], paintStyle: { fill: "red" },
                isSource: true,
                connectionType: "red-connection"
              });

              instance.addEndpoint(id, {
                endpoint: "Dot", maxConnections: 2,
                anchor: ["Left"],
                isTarget: true,
                connectionType: "red-connection"
              });
            }
          }
        })

      });



      /*var slider = document.getElementById("myRange");
      var output = document.getElementById("demo");
      output.innerHTML = slider.value;
      
      
      
      slider.oninput = function() {
        data3 = this.value;
        output.innerHTML = this.value;
      }*/


      document.getElementsByTagName("button")[0].onclick = contagem;

      function contagem() {

        var allConnections = instance.getConnections({
        });
        const Tid = []; const Sid = [];
        //alert(allConnections.length);
        for (var i = 0; i < allConnections.length; i++) {
          var target = allConnections[i].targetId;
          var source = allConnections[i].sourceId;
          Tid[i] = target;
          Sid[i] = source;
        }
        const set1 = new Set();
        for (var i = 0; i < Tid.length; i++) {
          set1.add(Tid[i]);
        }
        const arr = [...set1].sort();
        const set_1 = new Set(arr);
        const set2 = new Set();
        for (var i = 0; i < Sid.length; i++) {
          set2.add(Sid[i]);
        }
        const arr1 = [...set2].sort(); const arr_r = [];
        var c_r = 0, c_v = 0, c_d = 0, c_c = 0, j = 0, s_v;
        for (var i = 0; i < arr1.length; i++) {
          if (arr1[i][0] == 'r') { c_r++; arr_r[j] = arr1[i]; j++; }
          else if (arr1[i][0] == 'v') { c_v++; s_v = arr1[i]; }
          else if (arr1[i][0] == 'c') { c_c++; }
          else
            c_d++;
        }
        const set_2 = new Set(arr1);
        console.log(arr_r);
        if (Tid.length != 11 || Sid.length != 11 || !setsAreEqual(set_1, set_2) || c_r != 4 || c_v != 1 || c_d != 1 || c_c != 2) {
          swal("Wrong Connection");
        }
        else {
          var p_top=document.querySelector('#diagram').getBoundingClientRect().top;
         var p_left=document.querySelector('#diagram').getBoundingClientRect().left;
          var amp = {};
          for (var i = 0; i < Sid.length; i++) {
            amp[Sid[i]] = amp[Sid[i]] || [];
            amp[Sid[i]].push(Tid[i]);
          }
          for (var i = 0; i < Tid.length; i++) {
            amp[Tid[i]] = amp[Tid[i]] || [];
            amp[Tid[i]].push(Sid[i]);
          }
          console.log(amp);
          const s_element = new Set();
          var s = amp[arr[2]][0];
          s_element.add(s);
          const r_pos = [], c_pos = [];
          if (s[0] != 'r' || amp[s].length != 3 || amp[s][0] != arr[7]) {
            swal("Wrong Connection");
          }
          else {
            var r_top = document.querySelector('#' + s + '').getBoundingClientRect().bottom-p_top;
            var r_left = document.querySelector('#' + s + '').getBoundingClientRect().left - p_left+10;
            r_pos[3] = [r_top, r_left];
            s_element.add(s);
            if (amp[s][2] != arr[2])
              s = amp[s][2];
            else
              s = amp[s][1];
            if (s_element.has(s) || s[0] != 'c' || amp[s].length != 2 || amp[s][0][0] != 'r')
            swal("Wrong Connection");
            else {
              r_top = document.querySelector('#' + s + '').getBoundingClientRect().bottom-p_top;
              r_left = document.querySelector('#' + s + '').getBoundingClientRect().left - p_left+10;
              c_pos[1] = [r_top, r_left];
              s_element.add(s);
              s = amp[s][1];
              if (s_element.has(s) || s[0] != 'r' || amp[s].length != 2 || amp[s][1] != arr[7])
              swal("Wrong Connection");
              else {
                r_top = document.querySelector('#' + s + '').getBoundingClientRect().bottom-p_top;
                r_left = document.querySelector('#' + s + '').getBoundingClientRect().left - p_left+10;
                r_pos[1] = [r_top, r_left];
                s_element.add(s);
                s = amp[arr[2]][1];
                if (s[0] != 'r' && s[0] != 'c')
                swal("Wrong Connections");
                else {
                  if (s[0] == 'r') {
                    /*if (s_element.has(s) || amp[s].length != 2 || amp[s][1] != arr[7])
                      alert("Wrong Connection");
                    else {
                      r_top = document.querySelector('#' + s + '').getBoundingClientRect().top + 30;
                      r_left = document.querySelector('#' + s + '').getBoundingClientRect().left - 210;
                      r_pos[0] = [r_top, r_left];
                      s_element.add(s);
                      s = amp[arr[2]][1];*/
                      if (s_element.has(s) || amp[s].length != 3 || amp[s][2] != arr[7])
                      swal("Wrong Connection");
                      else {
                        r_top = document.querySelector('#' + s + '').getBoundingClientRect().bottom-p_top;
                        r_left = document.querySelector('#' + s + '').getBoundingClientRect().left - p_left+10;
                        r_pos[0] = [r_top, r_left];
                        s_element.add(s);
                        if (amp[s][1] != arr[2]) { s = amp[s][1]; }
                        else { s = amp[s][0]; }
                        console.log(s);
                        if (s_element.has(s) || amp[s].length != 3 || amp[s][0] != arr[7])
                          swal("Wrong Connection");
                        else {
                          r_top = document.querySelector('#' + s + '').getBoundingClientRect().bottom-p_top;
                          r_left = document.querySelector('#' + s + '').getBoundingClientRect().left - p_left+10;
                          r_pos[2] = [r_top, r_left];
                          s_element.add(s);
                          
                          if(s_element.has(amp[s][1]))
                            s=amp[s][2];
                          else
                           s=amp[s][1];
                          if(amp[s].length!=2 || amp[s][1]!=arr[7] || s[0]!='c'){
                            swal("Wrong Connections");
                          }
                          else{
                            r_top = document.querySelector('#' + s + '').getBoundingClientRect().bottom-p_top;
                          r_left = document.querySelector('#' + s + '').getBoundingClientRect().left - p_left+10;
                          c_pos[0] = [r_top, r_left];
                          swal("Right Connections...Go Ahead!!");
                          omega=randomIntFromInterval(50, 3000);


                          console.log(omega);

                          var f = document.getElementById("btn1");
                          f.removeAttribute("disabled")
                          var v_top = document.querySelector('#' + s_v + '').getBoundingClientRect().bottom-p_top;
                          var v_left = document.querySelector('#' + s_v + '').getBoundingClientRect().left - p_left+10;

                          $("<div id='abcd' style = 'position: absolute;top:" + v_top + "px ; left:" + v_left + "px ;'><b>+ V,f -</b></div>")
                            .appendTo("#diagram");



                            for (var i = 0; i < 4; i++) {
                              $("<div id='r1_tag"+i+"' style = 'position: absolute;top:" + r_pos[i][0] + "px ; left:" + r_pos[i][1] + "px ;'><b>R" + (i + 1) + "</b></div>")
                                .appendTo("#diagram");
                            }


                            $("<div id='c1_tag0' style = 'position: absolute;top:" + c_pos[0][0] + "px ; left:" + c_pos[0][1] + "px ;'><b>C" + 1 + "</b></div>")
                              .appendTo("#diagram");
                            $("<div id='c1_tag1' style = 'position: absolute;top:" + c_pos[1][0] + "px ; left:" + c_pos[1][1] + "px ;'><b>C" + 2 + "</b></div>")
                              .appendTo("#diagram");
                          mydiv.style.display = "block";

                          var div1 = document.getElementById("diagram");
                          var div2 = document.getElementById("toolbox");

                          div1.classList.add("no-pointer-events");
                          div2.classList.add("no-pointer-events");
                        
                        }
                      }
                    }
                  }
                  else {
                    if (s_element.has(s) || amp[s].length != 3 || amp[s][2] != arr[7])
                    swal("Wrong Connections");
                    else {
                      r_top = document.querySelector('#' + s + '').getBoundingClientRect().bottom-p_top;
                      r_left = document.querySelector('#' + s + '').getBoundingClientRect().left - p_left+10;
                      c_pos[0] = [r_top, r_left];
                      s_element.add(s);
                      if(amp[s][1]!=arr[2])
                      s = amp[s][1];
                      else
                       s=amp[s][0];
                      if (s_element.has(s) || amp[s].length != 3 || amp[s][0] != arr[7])
                      swal("Wrong Connections");
                      else {
                        r_top = document.querySelector('#' + s + '').getBoundingClientRect().bottom-p_top;
                        r_left = document.querySelector('#' + s + '').getBoundingClientRect().left - p_left+10;
                        r_pos[2] = [r_top, r_left];
                        s_element.add(s);
                        if(s_element.has(amp[s][1]))
                        s = amp[s][2];
                        else
                         s=amp[s][1];
                        if (s_element.has(s) || amp[s].length != 2 || amp[s][1] != arr[7] || s[0]!='r')
                        swal("Wrong Connection");
                        
                          else {
                            r_top = document.querySelector('#' + s + '').getBoundingClientRect().bottom-p_top;
                            r_left = document.querySelector('#' + s + '').getBoundingClientRect().left - p_left+10;
                            r_pos[0] = [r_top, r_left];
                            s_element.add(s);
                            swal("Right Connections...Go Ahead!!");
                            var f = document.getElementById("btn1");
                            f.removeAttribute("disabled")

                            var v_top = document.querySelector('#' + s_v + '').getBoundingClientRect().bottom-p_top;
                            var v_left = document.querySelector('#' + s_v + '').getBoundingClientRect().left - p_left+10;

                            $("<div id='abcd' style = 'position: absolute;top:" + v_top + "px ; left:" + v_left + "px ;'><b>+ V,f -</b></div>")
                              .appendTo("#diagram");



                            for (var i = 0; i < 4; i++) {
                              $("<div id='r1_tag"+i+"' style = 'position: absolute;top:" + r_pos[i][0] + "px ; left:" + r_pos[i][1] + "px ;'><b>R" + (i + 1) + "</b></div>")
                                .appendTo("#diagram");
                            }


                            $("<div id='c1_tag0' style = 'position: absolute;top:" + c_pos[0][0] + "px ; left:" + c_pos[0][1] + "px ;'><b>C" + 1 + "</b></div>")
                              .appendTo("#diagram");
                            $("<div id='c1_tag1' style = 'position: absolute;top:" + c_pos[1][0] + "px ; left:" + c_pos[1][1] + "px ;'><b>C" + 2 + "</b></div>")
                              .appendTo("#diagram");
                            mydiv.style.display = "block";

                            var div1 = document.getElementById("diagram");
                            var div2 = document.getElementById("toolbox");

                            div1.classList.add("no-pointer-events");
                            div2.classList.add("no-pointer-events");
                          
                        }
                      }
                    }
                  }
                }

              }
            }
          }
        }
      }
      function setsAreEqual(a, b) {
        if (a.size !== b.size) {
          return false;
        }

        return Array.from(a).every(element => {
          return b.has(element);
        });
      }
    </script>
  </div>
</body>

</html>
